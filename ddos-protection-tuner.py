#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ADAPTIVE NETWORK TUNING SCRIPT FOR DDoS PROTECTION
–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞ Linux
"""

import os
import sys
import subprocess
from datetime import datetime


def collect_system_info():
    """
    –°–æ–±–∏—Ä–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
    """
    system_info = {}
    
    # 1. –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
    try:
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ñ–∞–π–ª /proc/meminfo
        with open('/proc/meminfo', 'r') as file:
            data = file.read()
        
        # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –æ–±—â–µ–π –ø–∞–º—è—Ç—å—é
        for line in data.split('\n'):
            if 'MemTotal:' in line:
                # –ü—Ä–∏–º–µ—Ä: "MemTotal: 2048000 kB" - –±–µ—Ä—ë–º —á–∏—Å–ª–æ
                parts = line.split()
                memory_kb = int(parts[1])
                system_info['total_memory_mb'] = memory_kb // 1024  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ú–ë
                break
                
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–º—è—Ç–∏: {e}")
        system_info['total_memory_mb'] = 1024  # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    # 2. –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
    try:
        with open('/proc/cpuinfo', 'r') as file:
            data = file.read()
        
        # –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
        # –ö–∞–∂–¥–æ–µ —è–¥—Ä–æ –∏–º–µ–µ—Ç —Å—Ç—Ä–æ–∫—É "processor"
        cpu_cores = data.count('processor')
        system_info['cpu_cores'] = cpu_cores if cpu_cores > 0 else 1
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ: {e}")
        system_info['cpu_cores'] = 1
    
    print(f"‚úì –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: {system_info['total_memory_mb']} –ú–ë –ø–∞–º—è—Ç–∏, "
          f"{system_info['cpu_cores']} —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞")
    
    return system_info


def detect_server_type(memory_mb, cpu_cores):
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤
    –ú–∞–ª–µ–Ω—å–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π –∏–ª–∏ –±–æ–ª—å—à–æ–π
    """
    if memory_mb <= 2048:  # ‚â§ 2 –ì–ë RAM
        return "small"
    elif memory_mb <= 8192:  # ‚â§ 8 –ì–ë RAM
        return "medium"
    else:  # > 8 –ì–ë RAM
        return "large"


def calculate_parameters(system_info):
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—É–ª—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
    """
    parameters = {}
    
    memory_mb = system_info['total_memory_mb']
    cpu_cores = system_info['cpu_cores']
    server_type = detect_server_type(memory_mb, cpu_cores)
    
    print(f"\nüìä –¢–∏–ø —Å–µ—Ä–≤–µ—Ä–∞: {server_type.upper()}")
    print("-" * 40)
    
    # ========== 1. –ó–ê–©–ò–¢–ê –û–¢ SYN-–§–õ–£–î–ê ==========
    
    # 1.1 –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ SYN-–ø–∞–∫–µ—Ç–æ–≤ (—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä!)
    # –§–æ—Ä–º—É–ª–∞: 512 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–∞–∂–¥—ã–µ 1 –ì–ë –ø–∞–º—è—Ç–∏
    syn_backlog = (memory_mb // 1024) * 512
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
    if syn_backlog < 256:
        syn_backlog = 256  # –ú–∏–Ω–∏–º—É–º –¥–ª—è —Ä–∞–±–æ—Ç—ã
    elif syn_backlog > 65535:
        syn_backlog = 65535  # –ú–∞–∫—Å–∏–º—É–º –¥–ª—è 16-–±–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è
    
    parameters['net.ipv4.tcp_max_syn_backlog'] = syn_backlog
    print(f"   –û—á–µ—Ä–µ–¥—å SYN: {syn_backlog} —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π")
    
    # 1.2 –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ SYN-ACK
    # –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–∏ –∞—Ç–∞–∫–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
    parameters['net.ipv4.tcp_synack_retries'] = 2
    print(f"   –ü–æ–ø—ã—Ç–æ–∫ SYN-ACK: 2 (–±—ã—Å—Ç—Ä—ã–π —Å–±—Ä–æ—Å)")
    
    # 1.3 –í–∫–ª—é—á–∞–µ–º SYN cookies (–º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã —è–¥—Ä–∞)
    parameters['net.ipv4.tcp_syncookies'] = 1
    print(f"   SYN cookies: –í–ö–õ–Æ–ß–ï–ù–´")
    
    # ========== 2. –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–ï–î–ò–ù–ï–ù–ò–Ø–ú–ò ==========
    
    # 2.1 –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    # –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ –æ—á–µ—Ä–µ–¥–∏ SYN
    somaxconn = int(syn_backlog * 1.2)  # –ù–∞ 20% –±–æ–ª—å—à–µ
    if somaxconn > 65535:
        somaxconn = 65535
    parameters['net.core.somaxconn'] = somaxconn
    print(f"   –ú–∞–∫—Å. —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: {somaxconn}")
    
    # 2.2 –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    # –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–∏ DDoS –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
    parameters['net.ipv4.tcp_fin_timeout'] = 15  # —Å–µ–∫—É–Ω–¥
    print(f"   –í—Ä–µ–º—è FIN-WAIT: 15 —Å–µ–∫—É–Ω–¥")
    
    # 2.3 –ú–∞–∫—Å–∏–º—É–º '–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö' —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    # –ó–∞–≤–∏—Å—à–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
    max_orphans = memory_mb * 4  # 4 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ 1 –ú–ë –ø–∞–º—è—Ç–∏
    if max_orphans > 65536:
        max_orphans = 65536
    parameters['net.ipv4.tcp_max_orphans'] = int(max_orphans)
    print(f"   –ú–∞–∫—Å. orphan-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: {int(max_orphans)}")
    
    # ========== 3. –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–ß–ï–†–ï–î–Ø–ú–ò ==========
    
    # 3.1 –û—á–µ—Ä–µ–¥—å –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç–µ
    # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
    netdev_backlog = 1000 + (cpu_cores * 500)
    if netdev_backlog > 10000:
        netdev_backlog = 10000
    parameters['net.core.netdev_max_backlog'] = netdev_backlog
    print(f"   –û—á–µ—Ä–µ–¥—å –ø–∞–∫–µ—Ç–æ–≤: {netdev_backlog}")
    
    # ========== 4. –ë–ê–ó–û–í–ê–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ==========
    
    # 4.1 –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–µ ping-–∑–∞–ø—Ä–æ—Å—ã
    parameters['net.ipv4.icmp_echo_ignore_broadcasts'] = 1
    print(f"   –ò–≥–Ω–æ—Ä broadcast ping: –í–ö–õ–Æ–ß–ï–ù")
    
    # 4.2 –î–∏–∞–ø–∞–∑–æ–Ω –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤ (–¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
    parameters['net.ipv4.ip_local_port_range'] = "1024 65535"
    print(f"   –î–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤: 1024-65535")
    
    # 4.3 –û—Ç–∫–ª—é—á–∞–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä)
    parameters['net.ipv4.ip_forward'] = 0
    print(f"   IP-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è: –û–¢–ö–õ–Æ–ß–ï–ù–ê")
    
    return parameters, server_type


def check_current_values(parameters):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ
    """
    print("\nüìù –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´:")
    print("=" * 60)
    
    for param_name in parameters.keys():
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º subprocess –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
            result = subprocess.run(
                ['sysctl', '-n', param_name],
                capture_output=True,
                text=True,
                check=False
            )
            
            current_value = result.stdout.strip()
            print(f"{param_name:35} = {current_value}")
            
        except Exception as e:
            print(f"{param_name:35} = –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: {e}")


def apply_settings(parameters):
    """
    –ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É sysctl
    """
    print("\n‚öôÔ∏è  –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ù–û–í–´–• –ù–ê–°–¢–†–û–ï–ö:")
    print("=" * 60)
    
    applied_changes = []
    failed_changes = []
    
    for param_name, param_value in parameters.items():
        try:
            # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            command = ['sysctl', '-w', f"{param_name}={param_value}"]
            
            # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
            result = subprocess.run(
                command,
                capture_output=True,
                text=True,
                check=True
            )
            
            if result.returncode == 0:
                applied_changes.append(f"{param_name} = {param_value}")
                print(f"‚úì {param_name:35} ‚Üí {param_value}")
            else:
                failed_changes.append(param_name)
                print(f"‚úó {param_name:35} ‚Üí –û—à–∏–±–∫–∞")
                
        except subprocess.CalledProcessError as e:
            failed_changes.append(param_name)
            print(f"‚úó {param_name:35} ‚Üí –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {e}")
        except Exception as e:
            failed_changes.append(param_name)
            print(f"‚úó {param_name:35} ‚Üí –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
    
    return applied_changes, failed_changes


def save_log_file(applied_changes, parameters, system_info, server_type):
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    """
    try:
        # –°–æ–∑–¥–∞—ë–º –∏–º—è —Ñ–∞–π–ª–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        log_filename = f"/tmp/network_tuning_{timestamp}.log"
        
        with open(log_filename, 'w') as log_file:
            # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–æ–≥-—Ñ–∞–π–ª–∞
            log_file.write("=" * 70 + "\n")
            log_file.write("–õ–û–ì –ê–î–ê–ü–¢–ò–í–ù–û–ô –ù–ê–°–¢–†–û–ô–ö–ò –°–ï–¢–ï–í–û–ì–û –°–¢–ï–ö–ê\n")
            log_file.write("=" * 70 + "\n\n")
            
            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
            log_file.write("–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ò–°–¢–ï–ú–ï:\n")
            log_file.write(f"  –ü–∞–º—è—Ç—å: {system_info['total_memory_mb']} –ú–ë\n")
            log_file.write(f"  –Ø–¥—Ä–∞ CPU: {system_info['cpu_cores']}\n")
            log_file.write(f"  –¢–∏–ø —Å–µ—Ä–≤–µ—Ä–∞: {server_type}\n")
            log_file.write(f"  –í—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: {datetime.now()}\n\n")
            
            # –°–ø–∏—Å–æ–∫ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            if applied_changes:
                log_file.write("–ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:\n")
                log_file.write("-" * 70 + "\n")
                for change in applied_changes:
                    log_file.write(f"  {change}\n")
            else:
                log_file.write("–ù–ï–¢ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô\n")
            
            # –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            log_file.write("\n–í–°–ï –†–ê–°–°–ß–ò–¢–ê–ù–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:\n")
            log_file.write("-" * 70 + "\n")
            for param_name, param_value in parameters.items():
                log_file.write(f"  {param_name:35} = {param_value}\n")
            
            # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            log_file.write("\n\n–ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –î–ê–õ–¨–ù–ï–ô–®–ò–ú –î–ï–ô–°–¢–í–ò–Ø–ú:\n")
            log_file.write("=" * 70 + "\n")
            log_file.write("1. –î–õ–Ø –ü–û–°–¢–û–Ø–ù–ù–û–ì–û –°–û–•–†–ê–ù–ï–ù–ò–Ø –ù–ê–°–¢–†–û–ï–ö:\n")
            log_file.write("   –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ñ–∞–π–ª /etc/sysctl.conf\n")
            log_file.write("   –ü—Ä–∏–º–µ—Ä: echo 'net.ipv4.tcp_max_syn_backlog = 8192' >> /etc/sysctl.conf\n\n")
            
            log_file.write("2. –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –ù–ê–°–¢–†–û–ï–ö:\n")
            log_file.write("   sysctl -a | grep 'tcp_max_syn_backlog\\|somaxconn\\|synack'\n")
            log_file.write("   sysctl -p  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ sysctl.conf\n\n")
            
            log_file.write("3. –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ó–ê–©–ò–¢–´:\n")
            log_file.write("   sudo apt install hping3  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç\n")
            log_file.write("   hping3 -S -p 80 --flood target_ip  # –ò–º–∏—Ç–∞—Ü–∏—è SYN-—Ñ–ª—É–¥–∞\n")
        
        print(f"\nüìÅ –õ–æ–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: {log_filename}")
        return log_filename
        
    except Exception as e:
        print(f"‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥: {e}")
        return None


def show_help():
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∫—Ä–∏–ø—Ç–µ
    """
    help_text = """
    ======================================================================
    –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê –°–ï–¢–ï–í–û–ì–û –°–¢–ï–ö–ê LINUX –î–õ–Ø –ó–ê–©–ò–¢–´ –û–¢ DDoS
    ======================================================================
    
    –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
    –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä–∞ Linux
    –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ DDoS-–∞—Ç–∞–∫–∞–º –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ.
    
    –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò:
    1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞ (–ø–∞–º—è—Ç—å, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä)
    2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç SYN-—Ñ–ª—É–¥–∞, UDP-—Ñ–ª—É–¥–∞
    4. –°–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    
    –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
    sudo python3 ddos_protection.py
    
    –¢–†–ï–ë–£–ï–ú–´–ï –ü–†–ê–í–ê:
    –°–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (root)
    –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞ —á–µ—Ä–µ–∑ sysctl.
    
    –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
    ‚Ä¢ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏–º—ã
    ‚Ä¢ –°–æ–∑–¥–∞—ë—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ª–æ–≥
    ‚Ä¢ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ /etc/sysctl.conf
    
    –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:
    –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
    ‚Ä¢ hping3 - –∏–º–∏—Ç–∞—Ü–∏—è SYN-—Ñ–ª—É–¥–∞
    ‚Ä¢ siege - –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    ‚Ä¢ Apache Benchmark (ab)
    
    ======================================================================
    """
    print(help_text)


def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
    """
    print("\n" + "=" * 60)
    print("   –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê –°–ï–¢–ò –î–õ–Ø –ó–ê–©–ò–¢–´ –û–¢ DDoS")
    print("=" * 60)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–∫—Ä–∏–ø—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if os.geteuid() != 0:
        print("\n‚ùå –û–®–ò–ë–ö–ê: –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!")
        print("   –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∫–æ–º–∞–Ω–¥–æ–π:")
        print("   sudo python3 ddos_protection.py")
        sys.exit(1)
    
    # –®–∞–≥ 1: –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
    print("\nüîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ...")
    system_info = collect_system_info()
    
    # –®–∞–≥ 2: –†–∞—Å—á—ë—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    print("\nüßÆ –†–∞—Å—á—ë—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤...")
    parameters, server_type = calculate_parameters(system_info)
    
    # –®–∞–≥ 3: –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    check_current_values(parameters)
    
    # –®–∞–≥ 4: –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    print("\n" + "=" * 60)
    print("   –í–ù–ò–ú–ê–ù–ò–ï: –ë—É–¥—É—Ç –∏–∑–º–µ–Ω–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä–∞ Linux")
    print("=" * 60)
    
    user_input = input("\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): ").strip().lower()
    
    if user_input in ['y', 'yes', '–¥–∞', '–¥']:
        # –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        applied_changes, failed_changes = apply_settings(parameters)
        
        # –®–∞–≥ 6: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–∞
        log_file = save_log_file(applied_changes, parameters, system_info, server_type)
        
        # –®–∞–≥ 7: –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        print("\n" + "=" * 60)
        print("   –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ù–ê–°–¢–†–û–ô–ö–ò")
        print("=" * 60)
        
        if applied_changes:
            print(f"‚úì –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: {len(applied_changes)} –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
            print(f"‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å: {len(failed_changes)} –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
            
            if log_file:
                print(f"üìÅ –õ–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π: {log_file}")
            
            print("\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
            print("1. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:")
            print("   –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ /etc/sysctl.conf")
            print("2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:")
            print("   sysctl -p /etc/sysctl.conf")
            print("3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞—â–∏—Ç—É:")
            print("   sudo apt install hping3")
            
        else:
            print("‚ùå –ù–µ –±—ã–ª–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è")
            
    else:
        print("\n‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    
    print("\n" + "=" * 60)
    print("   –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê")
    print("=" * 60)


# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –∑–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
if __name__ == "__main__":
    main()